---

import { useEffect } from "react";
import Tree from "./Tree";

console.log("Astro.props", Astro.props);
const props = Astro.props.props;
console.log("Astro.props.props", props);
const BACKEND_URL = props.BACKEND_URL;
console.log("Astro.props.BACKEND_URL", BACKEND_URL);

let user_email;
let API_URL;

async function getUser(){
    let response = await fetch(`${BACKEND_URL}/protected`, {
        method: "GET",
        credentials: "include",
        headers: {
            "Content-Type": "application/json",
        },
    });
    if(!response.ok){
        throw new Error("Error en el protected");
    }
    return await response.json();
}

async function fetchUserAndSetEmail() {
    const userInfo = await getUser();
    user_email = userInfo.logged_in_as;
}

if(props.isPersonalTree){
    user_email = fetchUserAndSetEmail();
    API_URL = BACKEND_URL + '/api/personal/' + user_email;
}else{
    API_URL = BACKEND_URL + '/api';
}
props.API_URL = API_URL;
---

    <Tree isPersonal={props.isPersonal} API_URL={API_URL}/>
