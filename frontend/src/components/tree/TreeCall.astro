---

import Tree from "./Tree";



let user_email;
let API_URL;

const { BACKEND_URL, isPersonalTree } = Astro.props;

async function getUser(){
    let response = await fetch(`${BACKEND_URL}/protected`, {
        method: "GET",
        credentials: "include",
        headers: {
            "Content-Type": "application/json",
        },
    });
    if(!response.ok){
        throw new Error("Error en el protected");
    }
    return await response.json();
}

async function fetchUserAndSetEmail() {
    const userInfo = await getUser();
    user_email = userInfo.logged_in_as;
}

if(isPersonalTree){
    user_email = fetchUserAndSetEmail();
    API_URL = BACKEND_URL + '/api/personal/' + user_email;
}else{
    API_URL = BACKEND_URL + '/api';
}
---

<Tree client:only isPersonal={isPersonalTree} API_URL={API_URL}/>
